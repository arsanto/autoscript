# install wget and curl
apt-get update;apt-get -y install wget curl;


# remove unused
apt-get -y --purge remove samba*;
apt-get -y --purge remove apache2*;
apt-get -y --purge remove sendmail*;
apt-get -y --purge remove bind9*;

# disable exim
service exim4 stop
sysv-rc-conf exim4 off

# get ip
MYIP=`curl -s icanhazip.com`;
MYIP2="s/xxxxxxxxx/$MYIP/g";

apt-get -y install squid3

mv /etc/squid3/squid.conf /etc/squid3/squid.conf.bak
	cat > /tmp/squid.conf.tmp2 <<END
acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl SSL_ports port 443
acl Safe_ports port 21
acl Safe_ports port 70
acl Safe_ports port 80
acl Safe_ports port 210
acl Safe_ports port 280
acl Safe_ports port 443
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl Safe_ports port 1025-65535
acl CONNECT method CONNECTacl SSH dst 139.59.108.159-139.59.108.159/255.255.255.255
http_access allow SSH
http_access allow manager localhost
http_access deny manager
http_access allow localhost
http_access deny all
http_port 8181
#http_port 8000
#http_port 8080
#http_port 3128
coredump_dir /var/spol/squid3
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320
END
	
	cat /tmp/squid.conf.tmp2 /tmp/squid.conf.tmp1	> /etc/squid3/squid.conf
	cat /dev/null > /etc/security/limits.conf

cat << EOF | tee -a /etc/security/limits.conf
*       -       maxlogins       1
EOF

sed -i $MYIP2 /etc/squid3/squid.conf;

service squid3 restart 
service ssh restart
